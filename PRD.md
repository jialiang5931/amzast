# 产品需求文档 (PRD) - AMZAST 亚马逊电商数据可视化平台

## 1. 文档信息
| 项目 | 内容 |
| :--- | :--- |
| **项目名称** | AMZAST (Amazon Data Analysis & Visualization Tool) |
| **版本** | v2.0 |
| **状态** | 开发中 (In Progress) |
| **最后更新** | 2026-02-09 |

## 2. 项目背景与目标
### 2.1 背景
当前亚马逊电商公司内部人员在进行文档数据分析时，缺乏统一、高效的可视化工具。处理 Excel/CSV 数据通常依赖手动操作，效率低下且难以直观发现数据趋势。同时，多数据源的整合（产品信息、关键词分析、历史销量）需要手动合并，耗时且易出错。

### 2.2 目标
构建一个 **纯前端 Web 数据可视化应用**，旨在：
- **安全高效**：数据完全在本地浏览器端处理，不上传至服务器，确保数据隐私。
- **自动化分析**：用户拖拽上传规范化 Excel 数据后，毫秒级解析并生成报表。
- **智能合并**：支持多文件自动识别与横向合并（产品表 + 关键词表 + 销量表）。
- **高端体验**：提供深色模式、流畅动画和交互式图表的现代化体验。

## 3. 用户角色与流程
### 3.1 目标用户
- **主要用户**：运营人员、产品开发、数据分析师。
- **特征**：关注销量趋势、竞品分析、定价策略、关键词效果、历史数据追踪。

### 3.2 核心流程
1. **进入首页**：看到功能矩阵卡片（我的项目、市场分析、搜索列表生成等）。
2. **选择功能**：
   - **市场分析**：上传单个产品数据文件，查看可视化图表。
   - **搜索列表生成**：上传多个文件（产品表 + 关键词表 + 销量表），自动合并生成综合分析表。
3. **上传校验**：拖拽上传本地 Excel (`.xlsx`) 文件，系统自动识别文件类型并校验关键字段。
4. **展示交互**：解析数据后，通过侧边栏快速切换不同分析维度，或在表格中查看详细数据。
5. **导出数据**：支持导出带嵌入图片的 Excel 文件，保留完整产品信息。

## 4. 功能需求
### 4.1 数据输入
#### 4.1.1 支持格式
- **主格式**：`.xlsx` (Excel Workbook)
- **文件类型识别**：
  - **主产品表**：`Product-{国家}-{日期}.xlsx`（如 `Product-US-20260206.xlsx`）
  - **关键词分析表**：`关键词分析_*.xlsx`
  - **销量数据表**：`product-{国家}-sales-{日期}-{编号}.xlsx`（支持多个）

#### 4.1.2 核心字段
- **基础信息**：ASIN, 品牌, 价格, 上架时间, SKU, 商品标题, 商品主图
- **动态指标**：近30天销量, 评分, 评分数, 月度销售额/销量（动态列 `YYYY-MM`）
- **销量数据**（来自销量表）：
  - 产品历史月销量（父体）
  - 历史月销售额（父体）
  - 子体历史月销量
  - 子体历史月销售额
  - 历史月价格

### 4.2 搜索列表生成器 (Search List Generator)
#### 4.2.1 功能概述
智能合并多个数据源，生成统一的产品分析列表。

#### 4.2.2 文件识别与合并逻辑
1. **文件自动识别**：
   - 系统使用正则表达式自动识别上传的文件类型
   - 支持同时上传 1 个主产品表 + 1 个关键词表 + 多个销量表
   
2. **销量数据处理**：
   - 自动读取每个销量文件中的 5 张工作表：
     - `产品历史月销量` → 列名重命名为 `YYYY-MM-父-U`
     - `历史月销售额` → 列名重命名为 `YYYY-MM-父-M`
     - `子体历史月销量` → 列名重命名为 `YYYY-MM-子-U`
     - `子体历史月销售额` → 列名重命名为 `YYYY-MM-子-M`
     - `历史月价格` → 列名重命名为 `YYYY-MM-子-P`
   - 支持动态日期识别（如 2026-03, 2026-04 等未来月份）
   
3. **数据合并**：
   - 以 ASIN 为主键进行横向合并（Left Join）
   - 合并顺序：主产品表 + 关键词表 + 销量表
   - 多个销量文件的数据先聚合后再与主表合并

#### 4.2.3 表格展示
1. **列排序优化**：
   - 优先列（按顺序）：ASIN, 主图, 价格($), 子体销量, 月销量, 评分数, 评分, 上架时间, 品牌, FBA($)
   - 其余列按原始顺序排列
   
2. **UI 增强**：
   - **表头**：大号粗体文字（16px, font-extrabold），深色显示，固定在顶部
   - **主图列**：128x128px 产品图片，鼠标悬停放大 1.5 倍
   - **行间距**：紧凑设计（py-3），最大化数据展示密度
   - **横向滚动**：顶部和底部双滚动条同步，方便导航
   
3. **性能优化**：
   - 表格最多显示 500 条数据（避免渲染卡顿）
   - 使用 GPU 加速（will-change-transform）优化图片悬停动画
   - 异步图片解码（decoding="async"）

#### 4.2.4 导出功能
- **格式**：`.xlsx` (Excel with embedded images)
- **特性**：
  - 使用 `exceljs` 库生成高级 Excel 文件
  - 产品主图直接嵌入到单元格中（100x100px）
  - 导出包含全部数据（不受 500 行显示限制）
  - 自动处理跨域图片获取（含容错机制）
  - 文件命名：`merged_search_list_YYYY-MM-DD.xlsx`

### 4.3 数据可视化 (Market Analysis Dashboard)
需包含以下核心视图：

1. **月销图 (Monthly Sales Trend)**
   - **图表类型**：组合折线图 (Multi-Series Line Chart)
   - **核心逻辑**：基于"父ASIN"去重统计（同个父体月销只计一次），支持跨年份对比。
   - **交互**：中文横坐标 (1月-12月)，图例点击切换年份显隐，纵坐标自适应。

2. **品牌垄断分析 (Brand Monopoly)**
   - **图表类型**：垂直柱状图 (Vertical Bar Chart)
   - **内容**：按销量排序的 Top 20 品牌
   - **指标**：高亮显示"Top 3 市场份额"和"Top 10 市场份额"
   - **交互**：点击品牌柱状图可下钻查看该品牌的产品列表（Brand Detail）
   - **目的**：识别市场领导者和长尾效应

3. **价格分布 (Price Distribution)**
   - **图表类型**：散点图 (Scatter Plot)
   - **X轴**：价格 (Price)
   - **Y轴**: 销量 (Units)
   - **Tooltip**: 显示产品图片、标题、品牌、价格、评分、评论数、上架时间
   - **内容**：每个点代表一个 SKU，展示不同价格带的销量分布

4. **功能导航 (Module Navigation)**
   - **侧边栏 (Sidebar)**：可折叠侧边栏，支持留白切换。包含：首页、我的项目、搜索列表、市场分析、关键词、VOC
   - **首页 (Home)**：功能卡片网格，快速导航

## 5. 技术架构
### 5.1 前端技术栈
- **框架**：React 19 + TypeScript
- **构建工具**：Vite
- **样式**：Tailwind CSS
- **图表库**：Recharts
- **Excel 处理**：
  - `xlsx` (SheetJS) - 数据解析
  - `exceljs` - 高级 Excel 生成（支持图片嵌入）
- **图标**：Lucide React
- **动画**：Framer Motion

### 5.2 数据处理流程
1. **文件上传** → FileReader API 读取二进制数据
2. **Excel 解析** → XLSX.read() 转换为 JSON
3. **数据清洗** → 字段映射、类型转换、去重
4. **数据合并** → 基于 ASIN 的 Map 结构进行高效 Join
5. **可视化渲染** → Recharts 组件 + 自定义 Tooltip
6. **导出生成** → ExcelJS 创建 Workbook，嵌入图片，生成 Blob

## 6. 非功能需求 (NFR)
- **性能**：
  - 10MB 以内的 Excel 文件需在 2 秒内完成解析
  - 表格渲染限制 500 行以保证流畅性
  - 图片悬停动画使用 GPU 加速
- **隐私**：**Zero-Server Arch**，所有计算在客户端 (Browser Memory) 完成
- **UI 风格**：
  - Dark Mode 支持
  - Glassmorphism (毛玻璃效果)
  - Tailwind CSS 动效
  - 响应式设计
- **兼容性**：支持现代浏览器（Chrome, Edge, Firefox, Safari）

## 7. 用户体验优化
### 7.1 智能提示
- 文件上传区域显示支持的文件格式和命名规范
- 错误提示清晰明确（如缺少必要文件、ASIN 不匹配等）
- 数据量提示（显示总数据量和当前显示数量）

### 7.2 交互细节
- 表格固定表头，滚动时保持列名可见
- 双向同步的横向滚动条
- 产品图片悬停放大，方便查看细节
- 导出过程显示 Loading 状态和进度提示

### 7.3 性能反馈
- 文件解析时显示加载动画
- 大数据量时自动限制显示行数
- 导出时显示"正在打包图片..."状态

## 8. 后续规划
- [ ] 导出 PDF 报告功能
- [ ] 表格列排序功能（点击表头排序）
- [ ] 数据筛选器（按品牌、价格区间等筛选）
- [ ] 历史数据对比视图
- [ ] 自定义列显示/隐藏
- [ ] 数据导入模板下载
- [ ] 批量数据处理优化（Web Worker）
